<!doctype html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Edytuj grupę</title>

    <link href="/public/styles/_theme.css" type="text/css" rel="stylesheet"/>
    <link href="/public/styles/_base.css" type="text/css" rel="stylesheet"/>
    <link href="/public/styles/_components.css" type="text/css" rel="stylesheet"/>
    <link href="/public/styles/groups.css" type="text/css" rel="stylesheet"/>

    <link href="https://fonts.googleapis.com" rel="preconnect"/>
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&amp;display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet"/>
</head>

<body class="theme-light">
<div class="page-wrapper">
    <header class="app-bar">
        <div style="width: 48px; height: 48px; display: flex; align-items: center; justify-content: flex-start;">
            <a href="/groups/<?= $groupDto->id ?>" style="color: inherit; text-decoration: none; display: flex;">
                <span class="material-symbols-outlined">arrow_back</span>
            </a>
        </div>
        <h1>Edytuj grupę</h1>
        <div style="width: 48px; height: 48px;"></div>
    </header>

    <main class="page-form-container" style="padding-bottom: 2rem;">

        <?php if(isset($message)): ?>
        <p class="messages">
            <?= htmlspecialchars($message); ?>
        </p>
        <?php endif; ?>

        <div class="form-header-group">
            <h2 class="headline-text">Zmień nazwę grupy</h2>
            <p class="body-text" style="opacity: 0.7; margin-bottom: 0;">
                Zaktualizuj nazwę grupy, aby lepiej odzwierciedlała jej przeznaczenie.
            </p>
        </div>

        <form action="/groups/<?= $groupDto->id ?>/edit" method="POST">
            <input type="hidden" name="group_id" value="<?= $groupDto->id ?>" />

            <div class="input-field-wrapper">
                <label class="form-label" for="group_name">Nazwa grupy</label>
                <input
                    id="group_name"
                    name="group_name"
                    type="text"
                    class="input-group-text"
                    placeholder="np. Domownicy, Współlokatorzy"
                    value="<?= htmlspecialchars($groupDto->name) ?>"
                    required
                />
            </div>

            <div style="margin-top: 1rem;">
                <button type="submit" class="action-button primary" style="width: 100%;">
                    Zapisz zmiany
                </button>
            </div>
        </form>

        <hr style="margin: 2rem 0; border: none; border-top: 1px solid rgba(0,0,0,0.1);" />

        <div class="form-header-group">
            <h2 class="headline-text">Członkowie grupy</h2>
            <p class="body-text" style="opacity: 0.7; margin-bottom: 0;">
                Usuń użytkowników z grupy. Uwaga: operacja jest nieodwracalna.
            </p>
        </div>

        <?php if(!empty($usersToDelete)): ?>
            <div style="display: flex; flex-direction: column; gap: 0.5rem; margin-top: 1.5rem;">
                <?php foreach ($usersToDelete as $user):
                    $avatarUrl = isset($user->profile_picture) && !empty($user->profile_picture)
                        ? $user->profile_picture  // Usunięto htmlspecialchars aby nie podwójnie enkodować
                        : 'https://ui-avatars.com/api/?name=' . urlencode($user->firstname . '+' . $user->lastname) . '&size=44&background=4CAF50&color=fff&bold=true';
                ?>
                    <div class="group-list-item" style="display: flex; align-items: center; justify-content: space-between; padding: 1rem; background: var(--surface-container); border-radius: 12px;">
                        <div class="item-content" style="flex: 1; margin: 0;">
                            <div class="item-icon-wrapper">
                                <img class="user-avatar"
                                     alt="Avatar <?= htmlspecialchars($user->firstname) ?>"
                                     src="<?= htmlspecialchars($avatarUrl) ?>"
                                     style="width: 44px; height: 44px; border-radius: 50%; object-fit: cover;"/>
                            </div>
                            <div class="item-text-wrapper">
                                <p class="item-name"><?= htmlspecialchars($user->firstname . ' ' . $user->lastname) ?></p>
                                <p class="item-members" style="font-size: 0.875rem; opacity: 0.7;"><?= htmlspecialchars($user->email) ?></p>
                            </div>
                        </div>
                        <form action="/groups/<?= $groupDto->id ?>/deleteUser" method="POST" onsubmit="return confirm('Czy na pewno chcesz usunąć użytkownika <?= htmlspecialchars($user->firstname . ' ' . $user->lastname) ?> z grupy?');" style="margin: 0;">
                            <input type="hidden" name="user_id" value="<?= $user->id ?>" />
                            <button type="submit" class="action-button" style="background: var(--error); color: white; padding: 0.5rem 1rem; border-radius: 8px; border: none; cursor: pointer; display: flex; align-items: center; gap: 0.25rem;">
                                <span class="material-symbols-outlined" style="font-size: 1.25rem;">delete</span>
                                Usuń
                            </button>
                        </form>
                    </div>
                <?php endforeach; ?>
            </div>
        <?php else: ?>
            <p class="body-text" style="text-align: center; padding: 2rem 0; opacity: 0.7;">
                Brak członków do wyświetlenia.
            </p>
        <?php endif; ?>

    </main>
</div>
</body>
</html>
